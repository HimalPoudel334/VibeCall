{% extends "base.html" %}

{% block title %}Join Call - VibeCall{% endblock %}

{% block content %}
<div class="min-h-screen flex justify-center items-start pt-8">
    <div class="max-w-md w-full space-y-8">
        <div class="bg-white p-8 rounded-lg shadow-lg border border-gray-100">
            <div class="text-center">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">ðŸŽ¥ VibeCall</h1>
                <p class="text-gray-600 mb-6">Join your video conference room</p>
            </div>
            
            <div class="join-container" id="joinContainer">
                <div class="space-y-6">
                    <div class="input-group">
                        <label for="roomId" class="block text-sm font-medium text-gray-700 mb-2">Room ID</label>
                        <input id="roomId" type="text" 
                               class="relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-teal-500 focus:border-teal-500 focus:z-10 transition duration-200"
                               value="d7694d42-2fea-4f14-a086-add07a7bf876" />
                    </div>

                    <div class="space-y-3">
                        <a id="connectBtn" 
                                class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition duration-200 transform hover:-translate-y-0.5">
                            Connect & Join Call
                        </a>
                        
                        <button id="leaveBtn" 
                                class="hidden group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-200 transform hover:-translate-y-0.5"
                                disabled>
                            Leave Call
                        </button>
                    </div>

                    <div id="status" class="status disconnected text-center py-3 px-4 rounded-lg border border-gray-200 bg-gray-50 text-gray-700 font-medium">
                        Disconnected
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .status.connected {
        background-color: #f0fdf4;
        border-color: #bbf7d0;
        color: #166534;
    }
    
    .status.connecting {
        background-color: #fffbeb;
        border-color: #fde68a;
        color: #92400e;
    }
    
    .status.disconnected {
        background-color: #fef2f2;
        border-color: #fecaca;
        color: #991b1b;
    }
    
    .status.error {
        background-color: #fef2f2;
        border-color: #fecaca;
        color: #dc2626;
    }
</style>

<script>
        const connectBtn = document.getElementById('connectBtn');

        connectBtn.addEventListener('click', (e) => {
            const roomId = encodeURIComponent(document.getElementById('roomId').value.trim());

            if (!roomId) {
                e.preventDefault(); 
                alert("Room ID is required");
                return;
            }
            connectBtn.href = `/call/ws/video?roomId=${roomId}`;
        });

    
    document.getElementById('leaveBtn').addEventListener('click', function() {
        const status = document.getElementById('status');
        const connectBtn = document.getElementById('connectBtn');
        const leaveBtn = document.getElementById('leaveBtn');
        
        status.textContent = 'Disconnected';
        status.className = 'status disconnected text-center py-3 px-4 rounded-lg border border-gray-200 font-medium';
        
        connectBtn.disabled = false;
        leaveBtn.disabled = true;
    });


    async function getTurnCredentials() {
        const turnResponse = await fetch('http://localhost:8085/turn-credentials');
        const turnConfig = await turnResponse.json();

        const iceServers = [{ urls: 'stun:stun.l.google.com:19302' }];

        if (turnConfig && turnConfig.data && turnConfig.data.urls) {
            iceServers.push({
                urls: turnConfig.data.urls,
                username: turnConfig.data.username,
                credential: turnConfig.data.credential
            });
        }

        return iceServers;
    }
</script>
{% endblock %}
